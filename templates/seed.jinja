{% extends "head.jinja" %}
{% block content %}
    <h4>Permalink:</h4> <a href="{{permaLink}}">{{permaLink}}</a>
<form action="/download">
{%if spoilerLog != False%}
<h4>Seed: {{seed}}</h4>
{%endif%}
<h4>Included:</h4>
{%set ns = namespace(counter = 0)%}
<div class="container">
{% for key in include %}
    {% if ns.counter % 3 == 0%}
    {%endif%}
            <label>{{key.value}}</label>
    {%set ns.counter = ns.counter+1%}
    {% if ns.counter % 3 == 0 or loop.last%}
    {%endif%}
{% endfor %}
</div>

<div class="container exp">
<h4>Experience:</h4>
    {%set ns = namespace(counter = 0)%}
    {% for key in expTypes %}
        {% if ns.counter % 3 == 0 %}
        {% endif %}
        <div class="vertical"><h5 class="mb-0">{{key}}</h5> {% if key == "Sora" %}{{soraExpMult}}{% elif ns.counter < 6 %}{{formExpMult[ns.counter|int]}}{{formExpMult[ns.counter|string]}}{%else%}{{formExpMult[0|int]}}{{formExpMult[0|string]}}{% endif %}x</div>
        {% set ns.counter = ns.counter+1%}
        {% if ns.counter % 3 == 0%}
        {% endif %}
    {% endfor %}
</div>

    <h4>Keyblade Abilities:</h4> {%for keybladeAbility in keybladeAbilities %}{{keybladeAbility}} {%endfor%}

<h5 class="mb-0">Keyblade Minimum Stat</h5> {{keybladeMinStat}}
<h5 class="mb-0">Keyblade Max Stat</h5> {{keybladeMaxStat}}


<h5 class="mb-0">Hint System</h5>{{hintsType}}
<h5 class="mb-0">Starting Inventory</h5>{%for item in startingInventory%}{{idConverter[item]}}{%endfor%}
<h5 class="mb-0">Seed Modifiers</h5>{%for modifier in seedModifiers%}{{modifier}}{%endfor%}



<h4>Command Menu:</h4>
<select name="cmdMenuChoice">
    {% for key in cmdMenus %}
    <option value="{{key}}">{{cmdMenus[key]}}</option>
    {% endfor %}
</select>

 {# <div class="col-6">
<h4>Randomize BGM (PC ONLY)</h4>
<select name="randomBGM">
    {%for option in bgmOptions %}
    <option value="{{option}}">{{option}}</option>
    {%endfor%}
</select>
</div>  #}


{#<input type="submit" value="Download for PC" name="platform">#}
</form>

<button id="PCSX2" name="platform" value="PCSX2">Generate for PCSX2</button>
{# <button id="PC" name="platform" value="PC">Generate for PC</button> #}

<script>
$(function(){
    $('button').click(function(){
        var platform = $(this).val();
        var cmdMenuChoice = $("select[name=cmdMenuChoice]").val();
        var randomBGM = "Disabled";
        $("#downloadButtons button").prop('disabled',true).text("Generating...");
        var HOST = location.origin.replace(/^http/, 'ws')
        var socket = io(HOST);
        socket.on('connect', function(){
            socket.emit('download', {platform: platform, cmdMenuChoice: cmdMenuChoice, randomBGM: randomBGM});
        });
        socket.on('file', function(zip){
            console.log(zip);
            blob = new Blob([zip], {type:"application/zip"});
            saveAs(blob, "randoseed.zip");
            socket.disconnect();
        });
    });
});

function str2bytes (str) {
    var bytes = new Uint8Array(str.length);
    for (var i=0; i<str.length; i++) {
        bytes[i] = str.charCodeAt(i);
    }
    return bytes;
}
</script>
{%endblock%}


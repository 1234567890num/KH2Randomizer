{% extends "head.jinja" %}
{%block meta%}
    <meta content="KH2 Randomizer Seed" property="og:title">
  <meta content="{% for key in include%}{{key.value}}, {%endfor%}" property="og:description">
    <meta content="{{permalink}}" property="og:url">
    <meta content="{{url_for('static', filename='icon.png')}}" property="og:image">
    <meta content="#e32733" data-react-helmet="true" name="theme-color">
{%endblock%}
{% block content %}
<h4>Permalink:</h4> <a href="{{permaLink}}">{{permaLink}}</a>
<form action="/download">
{%if spoilerLog != False%}
<h4>Seed: {{seed}}</h4>
{%endif%}
<h4>Included:</h4>
<div class="container">
    {% for key in include %}
        <div><label>{{key.value}}</label></div>
    {% endfor %}
</div>

<div class="container exp">
    <h4>Experience:</h4>
        {%set ns = namespace(counter = 0)%}
        {% for key in expTypes %}
            <div class="vertical"><h5>{{key}}</h5>
                {% if key == "Sora" %}
                    {{soraExpMult}}
                {% elif ns.counter < 6 %}
                    {{formExpMult[ns.counter|int]}}{{formExpMult[ns.counter|string]}}
                {%else%}
                    {{formExpMult[0|int]}}{{formExpMult[0|string]}}
                {% endif %}x
            </div>
            {% set ns.counter = ns.counter+1%}
        {% endfor %}
</div>
<div class="container">
    <div class="vertical"><h4>Keyblade Abilities:</h4> {%for keybladeAbility in keybladeAbilities %}{{keybladeAbility}} {%endfor%}</div>
    <div class="vertical"><h5>Keyblade Minimum Stat</h5> {{keybladeMinStat}}</div>
    <div class="vertical"><h5>Keyblade Max Stat</h5> {{keybladeMaxStat}}</div>
</div>

<div class="container">
    <div class="vertical top"><h5>Hint System</h5>{{hintsType}}</div>
    <div class="vertical top"><h5>Starting Inventory</h5>{%for item in startingInventory%}{{idConverter[item]}}<br>{%endfor%}</div>
    <div class="vertical top"><h5>Seed Modifiers</h5>{%for modifier in seedModifiers%}{{modifier}}<br>{%endfor%}</div>
</div>


<h4>Command Menu:</h4>
<select name="cmdMenuChoice">
    {% for key in cmdMenus %}
    <option value="{{key}}">{{cmdMenus[key]}}</option>
    {% endfor %}
</select>

 {# <div class="col-6">
<h4>Randomize BGM (PC ONLY)</h4>
<select name="randomBGM">
    {%for option in bgmOptions %}
    <option value="{{option}}">{{option}}</option>
    {%endfor%}
</select>
</div>  #}


{#<input type="submit" value="Download for PC" name="platform">#}
</form>
<div id="downloadButtons">
<button id="PCSX2" name="platform" value="PCSX2">Generate for PCSX2</button>
{# <button id="PC" name="platform" value="PC">Generate for PC</button> #}
</div>
<script>
$(function(){
    $('button').click(function(){
        var platform = $(this).val();
        var cmdMenuChoice = $("select[name=cmdMenuChoice]").val();
        var randomBGM = "Disabled";
        $("#downloadButtons button").prop('disabled',true).text("Generating...");
        var HOST = location.origin.replace(/^http/, 'ws')
        var socket = io(HOST);
        socket.on('connect', function(){
            socket.emit('download', {platform: platform, cmdMenuChoice: cmdMenuChoice, randomBGM: randomBGM});
        });
        socket.on('file', function(zip){
            console.log(zip);
            blob = new Blob([zip], {type:"application/zip"});
            saveAs(blob, "randoseed.zip");
            socket.disconnect();
        });
    });
});

function str2bytes (str) {
    var bytes = new Uint8Array(str.length);
    for (var i=0; i<str.length; i++) {
        bytes[i] = str.charCodeAt(i);
    }
    return bytes;
}
</script>
{%endblock%}


<!DOCTYPE html>
<html lang="en">
    <head>
        <title>KH2FM Randomizer Spoiler Log</title>
    <script>
        seed_name = "SEED_NAME_STRING"
        sora_item_data = SORA_ITEM_JSON
        donald_item_data = DONALD_ITEM_JSON
        goofy_item_data = GOOFY_ITEM_JSON
        level_data = LEVEL_STATS_JSON
        form_exp_data = FORM_EXP_JSON
        depth_data = DEPTH_VALUES_JSON
        settings_data = SETTINGS_JSON
        boss_enemy_data = BOSS_ENEMY_JSON

    </script>

<style>
    @font-face {
        font-family: KHMenu;
        src: url("KHMenu.otf") format("opentype");
    }
    :root {
        --background: #1f2123;
    }
    *,*::before,*::after {
        box-sizing: border-box;
    }
    body{
        background-color: #31363b;
        color: #ffffff;
    }
    .content {
        background-blend-mode: multiply;
        background-size: cover;
        display: grid;
        place-items: center;
    }
    .table_wrapper{
        overflow-y:scroll;
        overflow-x:hidden;
    }

    .styled-table {
        /* background-color: #31363b; */
        border-collapse: collapse;
        margin: 0px 0;
        font-size: 0.8em;
        font-family: KHMenu, sans-serif;
        min-width: 500px;
        box-shadow: 0 0 20px rgba(255, 255, 255, 0.15);
        position: relative;
    }
    .styled-table thead tr {
        background-color: #53575c;
        color: #4dd0e1;
        text-align: center;
    }
    .styled-table th,
    .styled-table td {
        padding: 12px 15px;
    }
    .styled-table th {
        position: sticky;
        top: 0px;
        background-color: #53575c;
        color: #4dd0e1;
    }
    .styled-table tbody tr {
        border-bottom: 50px solid #000000;
        box-shadow: 0 0 20px rgba(255, 255, 255, 0.15);
    }
    .custom-class {
        border-bottom: 1px solid #000000;
        box-shadow: 0 0 20px rgba(255, 255, 255, 0.15);
    }

    .styled-table tbody tr:nth-of-type(odd) {
        background-color: #42474b;
    }

    .styled-table tbody tr:last-of-type {
        border-bottom: 2px solid #009879;
    }
    .styled-table tbody tr.active-row {
        font-weight: bold;
        color: #009879;
    }
    .accordion {
        background-color: #1f2123;
        box-shadow: 0 0 20px rgba(255, 255, 255, 0.15);
        color: #ffffff;
        font-size: 1.8em;
        font-family: KHMenu, sans-serif;
        cursor: pointer;
        padding: 18px;
        width: 95%;
        text-align: center;
        border: none;
        outline: none;
        transition: .4s;

    }
    .active, .accordion:hover {
        color: #4dd0e1;
    }
    .panel {
        padding: 0 18px;
        background-color: #31363b;
        overflow: hidden;
        max-height: 0;
        transition: max-height 0.2s ease-out;
    }
    .accordion:after {
        content: '\02795'; /* Unicode character for "plus" sign (+) */
        font-size: 1em;
        color: #777;
        float: left;
        margin-left: 5px;
    }

    .active:after {
        content: "\2796"; /* Unicode character for "minus" sign (-) */
    }

</style>
</head>
<body>
<div class="content" id="all_content">
    <h1 id="seed_header"></h1>
    <h3 id="settings-string"></h3>
    <button class="accordion">Form Experience Data</button>
    <div class="panel">
        <div class="table-wrapper">
            <table class="styled-table" id="formExpTable">
            </table>
        </div>
    </div>
    <button class="accordion">Level Experience Data</button>
    <div class="panel">
        <div class="table-wrapper">
            <table class="styled-table" id="expTable">
                <tr>
                    <th>Level</th>
                    <th>Experience</th>
                    <th>Strength</th>
                    <th>Magic</th>
                    <th>Defense</th>
                    <th>AP</th>
                </tr>
            </table>
        </div>
    </div>
    <button class="accordion">Item/Location Weights</button>
    <div class="panel">
        <div class="table-wrapper">
            <table class="styled-table" id="weightTable">
            </table>
        </div>
    </div>
    <button class="accordion">Sora Item Placement</button>
    <div class="panel">
        <div class="table-wrapper">
            <table class="styled-table" id="spoilerTable">
                <tr>
                    <th>World <input type="text" id="world_search" onkeyup="tableFilter('world_search','location_search','item_search','spoilerTable')" placeholder="Search for world.."></th>
                    <th>Location &lt;Weight&gt; <input type="text" id="location_search" onkeyup="tableFilter('world_search','location_search','item_search','spoilerTable')" placeholder="Search for location.."></th>
                    <th>Item <input type="text" id="item_search" onkeyup="tableFilter('world_search','location_search','item_search','spoilerTable')" placeholder="Search for item.."></th>
                </tr>
            </table>
        </div>
    </div>
    <button class="accordion">Party Item Placement</button>
    <div class="panel">
        <div class="table-wrapper">
            <table class="styled-table" id="partyItemTable">
                <tr>
                    <th>World <input type="text" id="party_world_search" onkeyup="tableFilter('party_world_search','party_location_search','party_item_search','partyItemTable')" placeholder="Search for world.."></th>
                    <th>Location <input type="text" id="party_location_search" onkeyup="tableFilter('party_world_search','party_location_search','party_item_search','partyItemTable')" placeholder="Search for location.."></th>
                    <th>Item <input type="text" id="party_item_search" onkeyup="tableFilter('party_world_search','party_location_search','party_item_search','partyItemTable')" placeholder="Search for item.."></th>
                </tr>
            </table>
        </div>
    </div>
</div>
</body>

<script>
if ("BOSSES" in boss_enemy_data)
{
    tabs = document.getElementById("all_content");
    //make a bosses tab
    var enemy_table = "<button class=\"accordion\">Boss Replacements</button><div class=\"panel\"><div class=\"table-wrapper\"><table class=\"styled-table\">"
    enemy_table+="<tr><th>Original Boss</th><th>New Boss</th></tr>";

    all_replaced = boss_enemy_data["BOSSES"];
    for(var i=0;i<all_replaced.length;i++)
    {
        enemy_table+="<tr class=\"custom-class\"><td>"+all_replaced[i]["original"]+"</td><td>"+all_replaced[i]["new"]+"</td></tr>";
    }
    enemy_table+="</table></div></div>";
    tabs.innerHTML+=enemy_table;
}
if ("ENEMIES" in boss_enemy_data)
{
    tabs = document.getElementById("all_content");
    //make an enemies tab
    var enemy_table = "<button class=\"accordion\">Enemy Replacements</button><div class=\"panel\"><div class=\"table-wrapper\"><table class=\"styled-table\">"
    enemy_table+="<tr><th>Original Enemy</th><th>New Enemy</th></tr>";

    all_replaced = boss_enemy_data["ENEMIES"];
    for(var i=0;i<all_replaced.length;i++)
    {
        enemy_table+="<tr class=\"custom-class\"><td>"+all_replaced[i]["original"]+"</td><td>"+all_replaced[i]["new"]+"</td></tr>";
    }
    enemy_table+="</table></div></div>";
    tabs.innerHTML+=enemy_table;
}


document.getElementById("seed_header").innerText = "Seed name: " + seed_name;
document.getElementById("settings-string").innerText = "Seed settings: " + settings_data;

function populateWeightTable()
{
    weight_table = document.getElementById("weightTable");
    var weight_header = document.createElement("tr");
    weight_header.innerHTML+="<th></th><th colspan=\""+String(depth_data["Common"].length)+"\">Location Weights</th>";
    weight_table.appendChild(weight_header);

    var data_row = document.createElement("tr");
    data_row.className = "custom-class"
    data_row.innerHTML+="<th>Item Type</th>";
    for(var i=0;i<depth_data["Common"].length;i++)
    { 
        data_row.innerHTML+="<th>"+String(i)+"</th>";
    }
    weight_table.appendChild(data_row);

    var data_row = document.createElement("tr");
    data_row.className = "custom-class"
    data_row.innerHTML+="<td>Common</td>";
    for(var i=0;i<depth_data["Common"].length;i++)
    { 
        data_row.innerHTML+="<td>"+String(depth_data["Common"][i])+"</td>";
    }
    weight_table.appendChild(data_row);
    var data_row = document.createElement("tr");
    data_row.className = "custom-class"
    data_row.innerHTML+="<td>Uncommon</td>";
    for(var i=0;i<depth_data["Uncommon"].length;i++)
    { 
        data_row.innerHTML+="<td>"+String(depth_data["Uncommon"][i])+"</td>";
    }
    weight_table.appendChild(data_row);
    var data_row = document.createElement("tr");
    data_row.className = "custom-class"
    data_row.innerHTML+="<td>Rare</td>";
    for(var i=0;i<depth_data["Rare"].length;i++)
    { 
        data_row.innerHTML+="<td>"+String(depth_data["Rare"][i])+"</td>";
    }
    weight_table.appendChild(data_row);
    var data_row = document.createElement("tr");
    data_row.className = "custom-class"
    data_row.innerHTML+="<td>Mythic</td>";
    for(var i=0;i<depth_data["Mythic"].length;i++)
    { 
        data_row.innerHTML+="<td>"+String(depth_data["Mythic"][i])+"</td>";
    }
    weight_table.appendChild(data_row);
}

populateWeightTable();

var formExpTable = document.getElementById("formExpTable");
var form_header = document.createElement("tr");
form_header.innerHTML+="<th>Form</th><th>Exp Multiplier</th><th>Level 2</th><th>Level 3</th><th>Level 4</th><th>Level 5</th><th>Level 6</th><th>Level 7</th>";
formExpTable.appendChild(form_header);
forms = ["Summon","Valor","Wisdom","Limit","Master","Final"];
for(var i=0;i<forms.length;i++)
{
    form_name = forms[i];
    var form_exp_row = document.createElement("tr");
    form_exp_row.className = "custom-class"
    var form_exp_string = ""
    form_exp_string+="<td>";
    form_exp_string+=form_name;
    form_exp_string+="</td><td>";
    form_exp_string+=String(form_exp_data[form_name]["multiplier"]);
    for(var j=0;j<6;j++)
    {
        form_exp_string+="</td><td>";
        form_exp_string+=String(form_exp_data[form_name]["values"][j]);
    }
    form_exp_string+="</td>";
    form_exp_row.innerHTML+=form_exp_string;
    formExpTable.appendChild(form_exp_row);
}

var levelStatTable = document.getElementById("expTable");
for (var i=1; i < 100; i++)
{
    var level_string = "Level "+String(i)
    var level_entry = level_data[level_string]
    var experience_value = "0";
    if (i!=1)
    {
        experience_value = level_data["Level "+String(i-1)]["experience"]
    }

    var table_entry = document.createElement("tr");
    table_entry.className = "custom-class"
    var level_html = "";
    level_html+="<td>"
    level_html+=String(i)
    level_html+="</td>"
    level_html+="<td>"
    level_html+=experience_value
    level_html+="</td>"
    level_html+="<td>"
    level_html+=level_entry["strength"]
    level_html+="</td>"
    level_html+="<td>"
    level_html+=level_entry["magic"]
    level_html+="</td>"
    level_html+="<td>"
    level_html+=level_entry["defense"]
    level_html+="</td>"
    level_html+="<td>"
    level_html+=level_entry["ap"]
    level_html+="</td>"
    table_entry.innerHTML += level_html;
    levelStatTable.appendChild(table_entry);
}

var acc = document.getElementsByClassName("accordion");
for(var i = 0; i < acc.length; i++)
{
    acc[i].addEventListener("click",function(){
        this.classList.toggle("active");

        var panel = this.nextElementSibling;
        if(panel.style.maxHeight){
            panel.style.maxHeight = null;
        }
        else{
            panel.style.maxHeight = panel.scrollHeight + "px";
        }
    });
}


worlds = ["Garden of Assemblage","Critical Bonuses","Space Paranoids", "Port Royal", "Twilight Town", "Olympus Coliseum", "Halloween Town", "Land of Dragons", "The World That Never Was", "Beast's Castle", "Agrabah", "Pride Lands", "Hollow Bastion", "Disney Castle / Timeless River", "Simulated Twilight Town", "Hundred Acre Wood", "Atlantica", "Puzzle"]



function populateTable(container, data)
{
    for(var j = 0; j < worlds.length; j++)
    {
        var world = worlds[j]
        if(world in data)
        {
            for (var i = 0; i < data[world].length; i++)
            {
                var table_entry = document.createElement("tr");
                table_entry.className = "custom-class"
                var world_table_html = "";
                world_table_html+="<td>"
                world_table_html+=world
                world_table_html+="</td>"
                var item_data = data[world][i]
                world_table_html+="<td>"
                world_table_html+=item_data[0]
                world_table_html+="</td>"
                world_table_html+="<td>"
                world_table_html+=item_data[1]["Name"] + " (" +item_data[1]["Rarity"] + ")";
                world_table_html+="</td>"
                table_entry.innerHTML += world_table_html;
                container.appendChild(table_entry);
            }
        }
    }

    if ("Level" in data)
    {
        for (var i = 0; i < data["Level"].length; i++)
        {
            var table_entry = document.createElement("tr");
            table_entry.className = "custom-class"
            var world_table_html = "";
            world_table_html+="<td>";
            world_table_html+="Levels";
            world_table_html+="</td>";
            var level_data = data["Level"][i];
            world_table_html+="<td>";
            world_table_html+=level_data[0];
            world_table_html+="</td>";
            world_table_html+="<td>";
            world_table_html+=level_data[1]["Name"] + " (" +level_data[1]["Rarity"] + ")";
            world_table_html+="</td>";
            table_entry.innerHTML += world_table_html;
            container.appendChild(table_entry);
        }
    }

    if ("Form Levels" in data)
    {
        for (var i = 0; i < data["Form Levels"].length; i++)
        {
            var table_entry = document.createElement("tr");
            table_entry.className = "custom-class"
            var world_table_html = "";
            world_table_html+="<td>";
            world_table_html+="Levels";
            world_table_html+="</td>";
            var level_data = data["Form Levels"][i]
            world_table_html+="<td>";
            world_table_html+=level_data[0];
            world_table_html+="</td>";
            world_table_html+="<td>";
            world_table_html+=level_data[1]["Name"] + " (" +level_data[1]["Rarity"] + ")";
            world_table_html+="</td>";
            table_entry.innerHTML += world_table_html;
            container.appendChild(table_entry);
        }
    }

    if ("Slot" in data)
    {
        for (var i = 0; i <  data["Slot"].length; i++)
        {
            var table_entry = document.createElement("tr");
            table_entry.className = "custom-class"
            var world_table_html = "";
            world_table_html+="<td>";
            world_table_html+="Weapons";
            world_table_html+="</td>";
            var weapon = data["Slot"][i]
            world_table_html+="<td>";
            world_table_html+=weapon[0];
            world_table_html+="</td>";
            world_table_html+="<td>";
            world_table_html+=weapon[1]["Name"] + " (" +weapon[1]["Rarity"] + ")";
            world_table_html+="</td>";
            table_entry.innerHTML += world_table_html;
            container.appendChild(table_entry);
        }
    }
}


var mainContainer = document.getElementById("spoilerTable");
var partyTable = document.getElementById("partyItemTable");
populateTable(mainContainer,sora_item_data)
populateTable(partyTable,donald_item_data)
populateTable(partyTable,goofy_item_data)

function tableFilter(world_elem,location_elem,item_elem,table_to_search)
{
    var input, world_filter, location_filter, item_filter, table, tr, td1, td2, td3, i, txtValue1, txtValue2, txtValue3;
    input = document.getElementById(world_elem);
    world_filter = input.value.toUpperCase();
    input = document.getElementById(location_elem);
    location_filter = input.value.toUpperCase();
    input = document.getElementById(item_elem);
    item_filter = input.value.toUpperCase();

    table = document.getElementById(table_to_search);
    tr = table.getElementsByTagName("tr");


    for(var i=1; i<tr.length; i++)
    {
        td1 = tr[i].getElementsByTagName("td")[0];
        td2 = tr[i].getElementsByTagName("td")[1];
        td3 = tr[i].getElementsByTagName("td")[2];

        var found = false;

        txtValue1 = txtValue2 = txtValue3 = "";

        if(td1)
        {
            txtValue1 = td1.textContent || td1.innerText;
        }
        if(td2)
        {
            txtValue2 = td2.textContent || td2.innerText;
        }
        if(td3)
        {
            txtValue3 = td3.textContent || td3.innerText;
        }

        if (txtValue1.toUpperCase().indexOf(world_filter) > -1 && txtValue2.toUpperCase().indexOf(location_filter) > -1 && txtValue3.toUpperCase().indexOf(item_filter) > -1)
        {
            found = true;
        }

        if (found)
        {
            tr[i].style.display = "";
        }
        else
        {
            tr[i].style.display = "none";
        }

    }

}

</script>
</html>